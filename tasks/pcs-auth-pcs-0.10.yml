- name: Pcs auth using pcs-0.10
  command:
    # Always auth all nodes to prevent possible corner cases with synchronizing
    # pcs auth tokens in the cluster when not all nodes are auth-ed.
    cmd: >
      pcs host auth -u hacluster
      {% for node in ansible_play_hosts %}
        '{{ hostvars[node].HA_Cluster.node_name | default(node) | quote }}'
        {% if hostvars[node].HA_Cluster.pcs_address | default("") %}
          addr={{ hostvars[node].HA_Cluster.pcs_address | quote }}
        {% endif %}
      {% endfor %}
    stdin: "{{ HA_Cluster_hacluster_password }}"
  run_once: yes
