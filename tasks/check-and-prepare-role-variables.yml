- name: Fail if passwords or authkeys are not specified
  fail:
    msg: "{{ item }} must be specified"
  when: lookup("vars", item, default="") | length < 1
  loop:
    - HA_Cluster_hacluster_password
    - HA_Cluster_authkey_corosync
    - HA_Cluster_authkey_pacemaker
  run_once: yes

- name: Extract all node names
  set_fact:
    HA_Cluster_internal_node_name: "{{ \
        hostvars[item].HA_Cluster.node_name | default(item) \
      }}"
  loop: "{{ ansible_play_hosts }}"
  run_once: yes
  register: HA_Cluster_internal_node_name_result

- name: Collect all node names
  set_fact:
    HA_Cluster_internal_all_node_names: "{{
        HA_Cluster_internal_node_name_result.results \
        | map(attribute='ansible_facts.HA_Cluster_internal_node_name') \
        | list \
      }}"
  run_once: yes
